(self.webpackChunkstrapi_backend=self.webpackChunkstrapi_backend||[]).push([[7692],{76539:(T,g,t)=>{"use strict";t.d(g,{Z:()=>s});var e=t(67294),i=t(86896),n=t(45697),a=t.n(n),m=t(81849),r=t(85018),y=t(67109),h=t(53979),p=t(11047),C=t(29728),A=t(30815),f=t(48474);const v=({onRegenerate:O,idToRegenerate:D,backUrl:N,onError:z})=>{const{formatMessage:F}=(0,i.Z)(),[K,Y]=(0,e.useState)(!1),{regenerateData:X,isLoadingConfirmation:Q}=(0,f.rW)(N,D,O,z),$=async()=>{X(),Y(!1)};return e.createElement(e.Fragment,null,e.createElement(C.z,{startIcon:e.createElement(A.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>Y(!0),name:"regenerate"},F({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(m.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(A.Z,null),isConfirmButtonLoading:Q,isOpen:K,onToggleDialog:()=>Y(!1),onConfirm:$,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};v.defaultProps={onRegenerate(){},onError:void 0},v.propTypes={onRegenerate:a().func,idToRegenerate:a().oneOfType([a().number,a().string]).isRequired,backUrl:a().string.isRequired,onError:a().func};const R=v,P=({title:O,token:D,setToken:N,canEditInputs:z,canRegenerate:F,isSubmitting:K,backUrl:Y,regenerateUrl:X,onErrorRegenerate:Q})=>{const{formatMessage:$}=(0,i.Z)(),J=ae=>{N({...D,accessKey:ae})};return e.createElement(h.T,{title:D?.name||$(O),primaryAction:z?e.createElement(p.k,{gap:2},F&&D?.id&&e.createElement(R,{backUrl:X,onRegenerate:J,idToRegenerate:D?.id,onError:Q}),e.createElement(C.z,{disabled:K,loading:K,startIcon:e.createElement(r.Z,null),type:"submit",size:"S"},$({id:"global.save",defaultMessage:"Save"}))):F&&D?.id&&e.createElement(R,{onRegenerate:J,idToRegenerate:D?.id,backUrl:X}),navigationAction:e.createElement(m.rU,{startIcon:e.createElement(y.Z,null),to:Y},$({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};P.propTypes={token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().oneOfType([a().number,a().string]),name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string}),canEditInputs:a().bool.isRequired,canRegenerate:a().bool.isRequired,setToken:a().func.isRequired,isSubmitting:a().bool.isRequired,backUrl:a().string.isRequired,title:a().shape({id:a().string,label:a().string}).isRequired,regenerateUrl:a().string.isRequired,onErrorRegenerate:a().func},P.defaultProps={token:void 0,onErrorRegenerate:void 0};const s=P},60401:(T,g,t)=>{"use strict";t.d(g,{Z:()=>C});var e=t(67294),i=t(45697),n=t.n(i),a=t(86896),m=t(48302),r=t(82562),y=t(75515),h=t(75056);const p=({token:A,errors:f,values:v,onChange:R,isCreating:P})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(e.Fragment,null,e.createElement(m.P,{name:"lifespan",label:s({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:v.lifespan!==null?v.lifespan:"0",error:f.lifespan?s(f.lifespan?.id?f.lifespan:{id:f.lifespan,defaultMessage:f.lifespan}):null,onChange:O=>{R({target:{name:"lifespan",value:O}})},required:!0,disabled:!P,placeholder:"Select"},e.createElement(r.W,{value:"604800000"},s({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(r.W,{value:"2592000000"},s({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(r.W,{value:"7776000000"},s({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(r.W,{value:"0"},s({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(y.Z,{variant:"pi",textColor:"neutral600"},!P&&`${s({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,h.IX)(A?.createdAt,parseInt(v.lifespan,10))}`))};p.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},p.defaultProps={errors:{},token:{}};const C=p},24122:(T,g,t)=>{"use strict";t.d(g,{Z:()=>f});var e=t(67294),i=t(86896),n=t(81849),a=t(12028),m=t(65186),r=t(69427),y=t(45697),h=t.n(y),p=t(74855),C=t.n(p);const A=({token:v,tokenType:R})=>{const{formatMessage:P}=(0,i.Z)(),s=(0,n.lm)(),{trackUsage:O}=(0,n.rS)(),D=(0,e.useRef)(O);return e.createElement(n.Y_,{endAction:v&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(p.CopyToClipboard,{onCopy:()=>{D.current("didCopyTokenKey",{tokenType:R}),s({type:"success",message:{id:"Settings.tokens.notification.copied"}})},text:v},e.createElement(a.h,{label:P({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),noBorder:!0,icon:e.createElement(m.Z,null),style:{padding:0,height:"1rem"}}))),title:v||P({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:P(v?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(r.Z,null),iconBackground:"neutral100"})};A.defaultProps={token:null},A.propTypes={token:h().string,tokenType:h().string.isRequired};const f=A},40695:(T,g,t)=>{"use strict";t.d(g,{Z:()=>y});var e=t(67294),i=t(45697),n=t.n(i),a=t(86896),m=t(64256);const r=({errors:h,values:p,onChange:C,canEditInputs:A})=>{const{formatMessage:f}=(0,a.Z)();return e.createElement(m.g,{label:f({id:"Settings.tokens.form.description",defaultMessage:"Description"}),name:"description",error:h.description?f(h.description?.id?h.description:{id:h.description,defaultMessage:h.description}):null,onChange:C,disabled:!A},p.description)};r.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},r.defaultProps={errors:{}};const y=r},61053:(T,g,t)=>{"use strict";t.d(g,{Z:()=>y});var e=t(67294),i=t(45697),n=t.n(i),a=t(86896),m=t(16364);const r=({errors:h,values:p,onChange:C,canEditInputs:A})=>{const{formatMessage:f}=(0,a.Z)();return e.createElement(m.o,{name:"name",error:h.name?f(h.name?.id?h.name:{id:h.name,defaultMessage:h.name}):null,label:f({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:C,value:p.name,disabled:!A,required:!0})};r.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},r.defaultProps={errors:{}};const y=r},31065:(T,g,t)=>{"use strict";t.d(g,{Z:()=>h});var e=t(67294),i=t(45697),n=t.n(i),a=t(86896),m=t(48302),r=t(82562);const y=({name:p,errors:C,values:A,onChange:f,canEditInputs:v,options:R,label:P})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(m.P,{name:p,label:s({id:P.id,defaultMessage:P.defaultMessage}),value:A&&A[p],error:C[p]?s(C[p]?.id?C[p]:{id:C[p],defaultMessage:C[p]}):null,onChange:f,placeholder:"Select",required:!0,disabled:!v},R&&R.map(({value:O,label:D})=>e.createElement(r.W,{key:O,value:O},s(D))))};y.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},y.defaultProps={name:"type",errors:{},options:[]};const h=y},47670:(T,g,t)=>{"use strict";t.d(g,{Z:()=>e,f:()=>i});const e="api-token",i="transfer-token"},57692:(T,g,t)=>{"use strict";t.d(g,{Z:()=>ze});var e=t(67294),i=t(86896),n=t(81849),a=t(185),m=t(49066),r=t(11047),y=t(41054),h=t(16550),p=t(88767),C=t(19631),A=t(75056),f=t(53979),v=t(29728),R=t(85018),P=t(45697),s=t.n(P);const O=({apiTokenName:o})=>{const{formatMessage:l}=(0,i.Z)();return(0,n.go)(),e.createElement(a.o,{"aria-busy":"true"},e.createElement(n.SL,{name:"API Tokens"}),e.createElement(f.T,{primaryAction:e.createElement(v.z,{disabled:!0,startIcon:e.createElement(R.Z,null),type:"button",size:"L"},l({id:"global.save",defaultMessage:"Save"})),title:o||l({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(m.D,null,e.createElement(n.dO,null)))};O.defaultProps={apiTokenName:null},O.propTypes={apiTokenName:s().string};const D=O;var N=t(87751);const z=(0,e.createContext)({}),F=({children:o,...l})=>e.createElement(z.Provider,{value:l},o),K=()=>(0,e.useContext)(z);F.propTypes={children:s().node.isRequired};const X=(o,l=[])=>({...o,selectedAction:null,routes:[],selectedActions:[],data:(0,A.mk)(l)});var Q=t(18172),$=t(97019),J=t.n($);const ae={data:{},selectedActions:[]},fe=(o,l)=>(0,Q.ZP)(o,c=>{switch(l.type){case"ON_CHANGE":{c.selectedActions.includes(l.value)?J()(c.selectedActions,l.value):c.selectedActions.push(l.value);break}case"SELECT_ALL_IN_PERMISSION":{l.value.every(E=>c.selectedActions.includes(E.actionId))?l.value.forEach(E=>{J()(c.selectedActions,E.actionId)}):l.value.forEach(E=>{c.selectedActions.push(E.actionId)});break}case"SELECT_ALL_ACTIONS":{c.selectedActions=[...c.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const I=c.data.allActionsIds.filter(E=>E.includes("find")||E.includes("findOne"));c.selectedActions=[...I];break}case"UPDATE_PERMISSIONS_LAYOUT":{c.data=(0,A.mk)(l.value);break}case"UPDATE_ROUTES":{c.routes={...l.value};break}case"UPDATE_PERMISSIONS":{c.selectedActions=[...l.value];break}case"SET_SELECTED_ACTION":{c.selectedAction=l.value;break}default:return c}});var oe=t(11276),H=t(74571),Z=t(75515),b=t(41580),ye=t(48403),Te=t.n(ye),he=t(48734),Ae=t(74756),ve=t(63081),me=t(36213),Ce=t(78114),ee=t(1565);const Ee=ee.iv`
  background: ${o=>o.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Pe=(0,ee.ZP)(b.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${o=>o.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${o=>o.isActive&&Ee}
  &:hover {
    ${Ee}
  }
`,Me=ee.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:o})=>o.colors.neutral150};
`,ie=({controllers:o,label:l,orderNumber:c,disabled:I,onExpanded:E,indexExpandendCollapsedContent:d})=>{const{value:{onChangeSelectAll:B,onChange:V,selectedActions:L,setSelectedAction:W,selectedAction:_}}=K(),[U,ne]=(0,e.useState)(!1),{formatMessage:w}=(0,i.Z)(),x=()=>{ne(k=>!k),E(c)};(0,e.useEffect)(()=>{d!==null&&d!==c&&U&&ne(!1)},[d,c,U]);const j=k=>k===_;return e.createElement(he.U,{expanded:U,onToggle:x,variant:c%2?"primary":"secondary"},e.createElement(Ae.B,{title:Te()(l)}),e.createElement(ve.v,null,o?.map(k=>{const se=k.actions.every(M=>L.includes(M.actionId)),de=k.actions.some(M=>L.includes(M.actionId));return e.createElement(b.x,{key:`${l}.${k?.controller}`},e.createElement(r.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(b.x,{paddingRight:4},e.createElement(Z.Z,{variant:"sigma",textColor:"neutral600"},k?.controller)),e.createElement(Me,null),e.createElement(b.x,{paddingLeft:4},e.createElement(me.X,{value:se,indeterminate:!se&&de,onValueChange:()=>{B({target:{value:[...k.actions]}})},disabled:I},w({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(oe.r,{gap:4,padding:4},k?.actions&&k?.actions.map(M=>e.createElement(H.P,{col:6,key:M.actionId},e.createElement(Pe,{isActive:j(M.actionId),padding:2,hasRadius:!0},e.createElement(me.X,{value:L.includes(M.actionId),name:M.actionId,onValueChange:()=>{V({target:{value:M.actionId}})},disabled:I},M.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>W({target:{value:M.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(Ce.Z,null)))))))})))};ie.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ie.propTypes={controllers:s().array,orderNumber:s().number,label:s().string.isRequired,disabled:s().bool,onExpanded:s().func,indexExpandendCollapsedContent:s().number};const Re=ie,re=({section:o,...l})=>{const[c,I]=(0,e.useState)(null),E=d=>I(d);return e.createElement(b.x,{padding:4,background:"neutral0"},o&&o.map((d,B)=>e.createElement(Re,{key:d.apiId,label:d.label,controllers:d.controllers,orderNumber:B,indexExpandendCollapsedContent:c,onExpanded:E,name:d.apiId,...l})))};re.defaultProps={section:null},re.propTypes={section:s().arrayOf(s().object)};const Oe=re;var Ie=t(35161),De=t.n(Ie),Se=t(13217),xe=t.n(Se);const ke=o=>{switch(o){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Le=(0,ee.ZP)(b.x)`
  margin: -1px;
  border-radius: ${({theme:o})=>o.spaces[1]} 0 0 ${({theme:o})=>o.spaces[1]};
`;function le({route:o}){const{formatMessage:l}=(0,i.Z)(),{method:c,handler:I,path:E}=o,d=E?xe()(E.split("/")):[],[B="",V=""]=I?I.split("."):[],L=ke(o.method);return e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h3"},l({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,B),e.createElement(Z.Z,{variant:"delta",textColor:"primary600"},".",V)),e.createElement(r.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Le,{background:L.background,borderColor:L.border,padding:2},e.createElement(Z.Z,{fontWeight:"bold",textColor:L.text},c)),e.createElement(b.x,{paddingLeft:2,paddingRight:2},De()(d,W=>e.createElement(Z.Z,{key:W,textColor:W.includes(":")?"neutral600":"neutral900"},"/",W)))))}le.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},le.propTypes={route:s().shape({handler:s().string,method:s().string,path:s().string})};const Be=le,Ue=()=>{const{value:{selectedAction:o,routes:l}}=K(),{formatMessage:c}=(0,i.Z)(),I=o?.split(".")[0];return e.createElement(H.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},o?e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},l[I]?.map(E=>E.config.auth?.scope?.includes(o)||E.handler===o?e.createElement(Be,{key:E.handler,route:E}):null)):e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h3"},c({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(Z.Z,{as:"p",textColor:"neutral600"},c({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Ze=({...o})=>{const{value:{data:l}}=K(),{formatMessage:c}=(0,i.Z)();return e.createElement(oe.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(H.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h2"},c({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(Z.Z,{as:"p",textColor:"neutral600"},c({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),l?.permissions&&e.createElement(Oe,{section:l?.permissions,...o})),e.createElement(Ue,null))},We=(0,e.memo)(Ze);var Ke=t(60401),be=t(61053),Ne=t(40695),Fe=t(31065);const ce=({errors:o,onChange:l,canEditInputs:c,isCreating:I,values:E,apiToken:d,onDispatch:B,setHasChangedPermissions:V})=>{const{formatMessage:L}=(0,i.Z)(),W=({target:{value:U}})=>{V(!1),U==="full-access"&&B({type:"SELECT_ALL_ACTIONS"}),U==="read-only"&&B({type:"ON_CHANGE_READ_ONLY"})},_=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(b.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(Z.Z,{variant:"delta",as:"h2"},L({id:"global.details",defaultMessage:"Details"})),e.createElement(oe.r,{gap:5},e.createElement(H.P,{key:"name",col:6,xs:12},e.createElement(be.Z,{errors:o,values:E,canEditInputs:c,onChange:l})),e.createElement(H.P,{key:"description",col:6,xs:12},e.createElement(Ne.Z,{errors:o,values:E,canEditInputs:c,onChange:l})),e.createElement(H.P,{key:"lifespan",col:6,xs:12},e.createElement(Ke.Z,{isCreating:I,errors:o,values:E,onChange:l,token:d})),e.createElement(H.P,{key:"type",col:6,xs:12},e.createElement(Fe.Z,{values:E,errors:o,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:U=>{W({target:{value:U}}),l({target:{name:"type",value:U}})},options:_,canEditInputs:c})))))};ce.propTypes={errors:s().shape({name:s().string,description:s().string,lifespan:s().string,type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({name:s().string,description:s().string,lifespan:s().oneOfType([s().number,s().string]),type:s().string}).isRequired,isCreating:s().bool.isRequired,apiToken:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().string,name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),onDispatch:s().func.isRequired,setHasChangedPermissions:s().func.isRequired},ce.defaultProps={errors:{},apiToken:{}};const $e=ce;var He=t(24122),Ve=t(76539),te=t(47670);const Ge="Name already taken",ze=()=>{(0,n.go)();const{formatMessage:o}=(0,i.Z)(),{lockApp:l,unlockApp:c}=(0,n.o1)(),I=(0,n.lm)(),E=(0,h.k6)(),[d,B]=(0,e.useState)(E.location.state?.apiToken.accessKey?{...E.location.state.apiToken}:null),{trackUsage:V}=(0,n.rS)(),L=(0,e.useRef)(V),{setCurrentStep:W}=(0,n.c1)(),{allowedActions:{canCreate:_,canUpdate:U,canRegenerate:ne}}=(0,n.ss)(N.Z.settings["api-tokens"]),[w,x]=(0,e.useReducer)(fe,ae,u=>X(u,{})),{params:{id:j}}=(0,h.$B)("/settings/api-tokens/:id"),{get:k,post:se,put:de}=(0,n.kY)(),M=j==="create";(0,p.useQuery)("content-api-permissions",async()=>{const[u,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async q=>{const{data:S}=await k(q);return S.data}));x({type:"UPDATE_PERMISSIONS_LAYOUT",value:u}),x({type:"UPDATE_ROUTES",value:G}),d&&(d?.type==="read-only"&&x({type:"ON_CHANGE_READ_ONLY"}),d?.type==="full-access"&&x({type:"SELECT_ALL_ACTIONS"}),d?.type==="custom"&&x({type:"UPDATE_PERMISSIONS",value:d?.permissions}))},{onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{L.current(M?"didAddTokenFromList":"didEditTokenFromList",{tokenType:te.Z})},[M]);const{status:Ye}=(0,p.useQuery)(["api-token",j],async()=>{const{data:{data:u}}=await k(`/admin/api-tokens/${j}`);return B({...u}),u?.type==="read-only"&&x({type:"ON_CHANGE_READ_ONLY"}),u?.type==="full-access"&&x({type:"SELECT_ALL_ACTIONS"}),u?.type==="custom"&&x({type:"UPDATE_PERMISSIONS",value:u?.permissions}),u},{enabled:!M&&!d,onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Xe=async(u,G)=>{L.current(M?"willCreateToken":"willEditToken",{tokenType:te.Z}),l();const q=u.lifespan&&parseInt(u.lifespan,10)&&u.lifespan!=="0"?parseInt(u.lifespan,10):null;try{const{data:{data:S}}=M?await se("/admin/api-tokens",{...u,lifespan:q,permissions:u.type==="custom"?w.selectedActions:null}):await de(`/admin/api-tokens/${j}`,{name:u.name,description:u.description,type:u.type,permissions:u.type==="custom"?w.selectedActions:null});M&&(E.replace(`/settings/api-tokens/${S.id}`,{apiToken:S}),W("apiTokens.success")),c(),B({...S}),I({type:"success",message:o(M?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),L.current(M?"didCreateToken":"didEditToken",{type:d.type,tokenType:te.Z})}catch(S){const ge=(0,C.Iz)(S.response.data);G.setErrors(ge),S?.response?.data?.error?.message===Ge?I({type:"warning",message:S.response.data.message||"notification.error.tokennamenotunique"}):I({type:"warning",message:S?.response?.data?.message||"notification.error"}),c()}},[je,pe]=(0,e.useState)(!1),Qe={...w,onChange:({target:{value:u}})=>{pe(!0),x({type:"ON_CHANGE",value:u})},onChangeSelectAll:({target:{value:u}})=>{pe(!0),x({type:"SELECT_ALL_IN_PERMISSION",value:u})},setSelectedAction:({target:{value:u}})=>{x({type:"SET_SELECTED_ACTION",value:u})}},ue=U&&!M||_&&M;return!M&&!d&&Ye!=="success"?e.createElement(D,{apiTokenName:d?.name}):e.createElement(F,{value:Qe},e.createElement(a.o,null,e.createElement(n.SL,{name:"API Tokens"}),e.createElement(y.J9,{validationSchema:A.fK,validateOnChange:!1,initialValues:{name:d?.name||"",description:d?.description||"",type:d?.type,lifespan:d?.lifespan?d.lifespan.toString():d?.lifespan},enableReinitialize:!0,onSubmit:(u,G)=>Xe(u,G)},({errors:u,handleChange:G,isSubmitting:q,values:S,setFieldValue:ge})=>(je&&S?.type!=="custom"&&ge("type","custom"),e.createElement(n.l0,null,e.createElement(Ve.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:d,setToken:B,canEditInputs:ue,canRegenerate:ne,isSubmitting:q,regenerateUrl:"/admin/api-tokens/"}),e.createElement(m.D,null,e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(d?.name)&&e.createElement(He.Z,{token:d?.accessKey,tokenType:te.Z}),e.createElement($e,{errors:u,onChange:G,canEditInputs:ue,isCreating:M,values:S,apiToken:d,onDispatch:x,setHasChangedPermissions:pe}),e.createElement(We,{disabled:!ue||S?.type==="read-only"||S?.type==="full-access"}))))))))}},75056:(T,g,t)=>{"use strict";t.d(g,{IX:()=>m,fK:()=>p,mk:()=>A});var e=t(6406),i=t(77349),n=t(51991);const m=(f,v,R="en")=>{if(v&&typeof v=="number"){const P=v/24/60/60/1e3;return(0,e.Z)((0,i.Z)(new Date(f),P),"PPP",{locale:n[R]})}return"Unlimited"};var r=t(87561),y=t(81849);const p=r.Ry().shape({name:r.Z_(y.I0.string).max(100).required(y.I0.required),type:r.Z_(y.I0.string).oneOf(["read-only","full-access","custom"]).required(y.I0.required),description:r.Z_().nullable(),lifespan:r.Rx().integer().min(0).nullable().defined(y.I0.required)}),A=f=>{const v={allActionsIds:[],permissions:[]};return v.permissions=Object.keys(f).map(R=>({apiId:R,label:R.split("::")[1],controllers:Object.keys(f[R].controllers).map(P=>({controller:P,actions:f[R].controllers[P].map(s=>{const O=`${R}.${P}.${s}`;return R.includes("api::")&&v.allActionsIds.push(O),{action:s,actionId:O}}).flat()})).flat()})),v}},41848:T=>{function g(t,e,i,n){for(var a=t.length,m=i+(n?1:-1);n?m--:++m<a;)if(e(t[m],m,t))return m;return-1}T.exports=g},42118:(T,g,t)=>{var e=t(41848),i=t(62722),n=t(42351);function a(m,r,y){return r===r?n(m,r,y):e(m,i,y)}T.exports=a},74221:T=>{function g(t,e,i,n){for(var a=i-1,m=t.length;++a<m;)if(n(t[a],e))return a;return-1}T.exports=g},62722:T=>{function g(t){return t!==t}T.exports=g},65464:(T,g,t)=>{var e=t(29932),i=t(42118),n=t(74221),a=t(7518),m=t(278),r=Array.prototype,y=r.splice;function h(p,C,A,f){var v=f?n:i,R=-1,P=C.length,s=p;for(p===C&&(C=m(C)),A&&(s=e(p,a(A)));++R<P;)for(var O=0,D=C[R],N=A?A(D):D;(O=v(s,N,O,f))>-1;)s!==p&&y.call(s,O,1),y.call(p,O,1);return p}T.exports=h},42351:T=>{function g(t,e,i){for(var n=i-1,a=t.length;++n<a;)if(t[n]===e)return n;return-1}T.exports=g},97019:(T,g,t)=>{var e=t(5976),i=t(45604),n=e(i);T.exports=n},45604:(T,g,t)=>{var e=t(65464);function i(n,a){return n&&n.length&&a&&a.length?e(n,a):n}T.exports=i},13217:(T,g,t)=>{var e=t(14259);function i(n){var a=n==null?0:n.length;return a?e(n,1,a):[]}T.exports=i}}]);
